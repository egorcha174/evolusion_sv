import{w as d}from"./C55cz5NW.js";async function w(){return await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function g(t){const n=await window.crypto.subtle.exportKey("raw",t),e=new Uint8Array(n);let r="";const o=e.byteLength;for(let c=0;c<o;c++)r+=String.fromCharCode(e[c]);return btoa(r)}async function u(t){const n=atob(t),e=new Uint8Array(n.length);for(let o=0;o<n.length;o++)e[o]=n.charCodeAt(o);return await window.crypto.subtle.importKey("raw",e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function f(t,n){const e=window.crypto.getRandomValues(new Uint8Array(12)),r=new TextEncoder().encode(t),o=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},n,r),c=new Uint8Array(e.length+o.byteLength);c.set(e),c.set(new Uint8Array(o),e.length);let i="";const a=c.byteLength;for(let s=0;s<a;s++)i+=String.fromCharCode(c[s]);return btoa(i)}async function S(t,n){const e=atob(t),r=new Uint8Array(e.length);for(let a=0;a<e.length;a++)r[a]=e.charCodeAt(a);const o=r.slice(0,12),c=r.slice(12),i=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:o},n,c);return new TextDecoder().decode(i)}async function l(){const t=localStorage.getItem("encryption_key");if(t)return u(t);{const n=await w(),e=await g(n);return localStorage.setItem("encryption_key",e),n}}const p=d({activeServer:null}),y="app_server_config_encrypted";async function h(){try{const t=localStorage.getItem(y);if(t){const n=await l(),e=await S(t,n),r=JSON.parse(e);r&&r.url&&r.token&&p.update(o=>({...o,activeServer:r}))}}catch(t){console.error("Failed to load server config",t),localStorage.removeItem(y)}}async function m(t){try{const n=await l(),e=JSON.stringify(t),r=await f(e,n);localStorage.setItem(y,r),p.update(o=>({...o,activeServer:t}))}catch(n){throw console.error("Failed to save server config",n),n}}export{p as a,h as l,m as s};
