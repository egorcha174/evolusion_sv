import{ae as d}from"./CHWeQpjd.js";async function S(){return await window.crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function m(t){const n=await window.crypto.subtle.exportKey("raw",t),e=new Uint8Array(n);let o="";const r=e.byteLength;for(let a=0;a<r;a++)o+=String.fromCharCode(e[a]);return btoa(o)}async function b(t){const n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;r++)e[r]=n.charCodeAt(r);return await window.crypto.subtle.importKey("raw",e,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"])}async function p(t,n){const e=window.crypto.getRandomValues(new Uint8Array(12)),o=new TextEncoder().encode(t),r=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:e},n,o),a=new Uint8Array(e.length+r.byteLength);a.set(e),a.set(new Uint8Array(r),e.length);let s="";const c=a.byteLength;for(let y=0;y<c;y++)s+=String.fromCharCode(a[y]);return btoa(s)}async function w(t,n){const e=atob(t),o=new Uint8Array(e.length);for(let c=0;c<e.length;c++)o[c]=e.charCodeAt(c);const r=o.slice(0,12),a=o.slice(12),s=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:r},n,a);return new TextDecoder().decode(s)}async function i(){const t=localStorage.getItem("encryption_key");if(t)return b(t);{const n=await S(),e=await m(n);return localStorage.setItem("encryption_key",e),n}}const u=d({activeServer:null}),g=d({cardOrder:[],timestamp:Date.now()}),l="app_server_config_encrypted",f="dashboard_layout_encrypted";async function v(){try{const t=localStorage.getItem(l);if(t){const n=await i(),e=await w(t,n),o=JSON.parse(e);o&&o.url&&o.token&&u.update(r=>({...r,activeServer:o}))}}catch(t){console.error("Failed to load server config",t),localStorage.removeItem(l)}}async function A(t){try{const n=await i(),e=JSON.stringify(t),o=await p(e,n);localStorage.setItem(l,o),u.update(r=>({...r,activeServer:t}))}catch(n){throw console.error("Failed to save server config",n),n}}async function C(){try{const t=localStorage.getItem(f);if(t){const n=await i(),e=await w(t,n),o=JSON.parse(e);g.set(o)}}catch(t){console.error("Failed to load layout:",t)}}async function E(t){const n={cardOrder:t,timestamp:Date.now()};try{const e=await i(),o=JSON.stringify(n),r=await p(o,e);localStorage.setItem(f,r),g.set(n)}catch(e){console.error("Failed to save layout:",e)}}export{u as a,C as b,g as c,E as d,v as l,A as s};
